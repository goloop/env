[//]: # (!!!Don't modify the README.md, use `make readme` to generate it!!!)


[![Go Report Card](https://goreportcard.com/badge/github.com/goloop/env)](https://goreportcard.com/report/github.com/goloop/env) [![License](https://img.shields.io/badge/license-BSD-blue)](https://github.com/goloop/env/blob/master/LICENSE) [![License](https://img.shields.io/badge/godoc-YES-green)](https://godoc.org/github.com/goloop/env)

*Version: .ModuleVersion*

# env

{{.EmitSynopsis}}


## Package features

The module contains synonyms for the standard methods from the os module like: Get, Set, Unset, Clear, Environ etc., to manage of environment and implements a special methods which allow saves variables from environment to a structures.

The main features:

- set variables of environment from the variables of env-file;
- convert (marshal) Go-structure to the variables of environment;
- pack (unmarshal) variables of environment to the Go-structure;
- set any variables to the environment;
- delete variables from the environment;
- determine the presence of a variable in the environment;
- get value of variable by key from the environment;
- cleaning environment.


The env-file can contain any environment valid constructions, for example:

```shell
# Supported:
# .................................................................
# Comments as separate entries.
KEY_000="value for key 000" # comment as part of the var declaration string
export KEY_001="value for key 001" # with export command
KEY_002=one:two:three # list with default separators, colon
KEY_003=one,two,three # ... or comma separator, or etc...
KEY_004=7 # numbers
KEY_005=John # string without quotes
PREFIX_KEY_005="Bob" # prefix filtering

# Empty line (up/down).

KEY_006=one,"two,three",four # grouped values as one | two,three | four
KEY_007=${KEY_005}00$KEY_004 # concatenation with variables: John007

KEY_008_LABEL="Service A" # deep embedded field
PREFIX_KEY_008_LABEL="Service B" # deep embedded field with prefix

# Not supported:
# .................................................................
# KEY_009= # empty value without quotes, need to use as: KEY_009=''
# 010_KEY=5 # incorrect variable name (name cannot starts with a digit)
# KEY_011="broken value, for example hasn't closing quote of the end
```

## Installation

To install the package you can use `go get`:

```
$ go get -u github.com/goloop/env
```


## Usage

To use this module import it as:

```go
import "github.com/goloop/env"
```


## Quick start

Let's marshal the env-file presented above to Go-structure.

```go
package main

import (
	"fmt"
	"log"

	"github.com/goloop/env"
)

// The key8 demonstrates a deeply nested field.
type key8 struct {
	Label string `env:"LABEL"`
}

// The config is object of some configuration.
type config struct {
	Key002 []string `env:"KEY_002" def:"[a:b:c]" sep:":"` // with default value
	Key005 string   `env:"KEY_005"`
	Key006 []string `env:"KEY_006" sep:","`
	Key008 key8     `env:"KEY_008"` // nested structure
}

func main() {
	// The file has several configurations with different prefixes.
	var a, b config

	// Update the environment.
	if err := env.Update(".env"); err != nil {
		log.Fatal(err)
	}

	// Unmarshal environment.
	env.Unmarshal("", &a)        // unmarshal all variables
	env.Unmarshal("PREFIX_", &b) // unmarshal variables with prefix only

	fmt.Printf("%v\n", a)
	fmt.Printf("%v\n", b)
	// Output:
	//  {[one two three] John [one "two,three" four] {Service A}}
	//  {[[a:b:c]] Bob [] {Service B}}
}
```

## Details

### Tags

Use the following tags in the fields of structure to
set the unmarshing parameters:

 - **env**  matches the name of the key in the environment;
 - **def**  default value (if empty, sets the default value for the field type of structure);
 - **sep**  sets the separator for lists/arrays (default ` ` - space).

### Examples

There is a web-project that is develop and tests on the local computer and
deploys on the production server. On the production server some settings
(for example `host` and `port`) forced stored in an environment but on the
local computer data must be loaded from the file (because different team
members have different launch options).

For example, the local-configuration file `.env` contains:

```shell
HOST=0.0.0.0
PORT=8080
ALLOWED_HOSTS="localhost:127.0.0.1"

# In configurations file and/or in the environment there can be
# a many of variables that willn't be parsed, like this:
SECRET_KEY="N0XRABLZ5ZZY6dCNgD7pLjTIlx8v4G5d"
```

We need to load the missing configurations from the file into the environment.
Convert data from the environment into Go-structure. And use this
data to start the server.

**Note:** We need load the missing variables but not update the existing ones.

```go
package main

import (
	"fmt"
	"log"
	"net/http"

	"github.com/goloop/env"
)

// Config it's struct of the server configuration.
type Config struct {
	Host         string   `env:"HOST"`
	Port         int      `env:"PORT"`
	AllowedHosts []string `env:"ALLOWED_HOSTS" sep:":"` // parse by `:`.
}

// Addr returns the server's address.
func (c *Config) Addr() string {
	return fmt.Sprintf("%s:%d", c.Host, c.Port)
}

// The homeHandler it is handler of the home page.
func homeHandler(w http.ResponseWriter, r *http.Request) {
	fmt.Fprintf(w, "Hello World!")
}

func main() {
	var config = Config{}

	// Load configurations from the env-file into an environment and
	// from environment to Go-struct.
	// Note: We use the Load (but not Update) method for as not to overwrite
	// the data in the environment because on the production server this
	// data can be set forcibly.
	env.Load(".env")
	env.Unmarshal("", &config)

	// Make routing.
	http.HandleFunc("/", homeHandler)

	// Run.
	log.Printf(
		"\nServer started on %s\nAllowed hosts: %v\n",
		config.Addr(),
		config.AllowedHosts,
	)
	log.Fatal(http.ListenAndServe(config.Addr(), nil))
	// Output:
	//  Server started on 0.0.0.0:0
	//  Allowed hosts: [localhost 127.0.0.1]
}
```
{{ .EmitUsage }}
